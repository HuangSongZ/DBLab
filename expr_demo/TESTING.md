# 表达式计算测试说明

## 1. 测试目的

本测试旨在比较两种表达式计算方法的性能：
1. 基于树遍历的递归计算方法
2. 基于扁平数组的指令序列方法

通过随机生成的表达式，评估两种方法的计算速度和性能差异。

## 2. 测试环境

- 操作系统: Linux
- 编译器: GCC
- 优化级别: -O2
- 机器信息:
  - CPU: Intel(R)Core(TM)i5-10210UCPU@1.60GHz
  - 内存: 8144092KB

## 3. 测试方法

### 3.1 示例表达式测试

1. **表达式构建**
   - 生成表达式: `(x0 + 2.5) * (x1 - 1.0) / (x2 + x3)`
   - 设置变量值: x0=5.0, x1=3.0, x2=2.0, x3=1.0

2. **测试步骤**
   - 使用树遍历方法计算结果
   - 将表达式编译为扁平化指令序列
   - 使用扁平数组方法计算结果
   - 验证两种方法的结果一致性

### 3.2 性能对比测试

1. **随机表达式生成**
   - 使用递归算法生成随机表达式树
   - 控制参数:
     - 最大深度: 5
     - 叶子节点生成概率: 30%
     - 常量值范围: 0.0 - 10.0

2. **测试流程**
   - 执行5次独立测试
   - 每次测试:
     1. 生成随机表达式
     2. 编译为扁平化指令序列
     3. 预热计算（各方法执行1次）
     4. 树遍历方法性能测试（执行100万次）
     5. 扁平数组方法性能测试（执行100万次）
     6. 记录执行时间

3. **性能指标**
   - 单次测试时间（秒）
   - 性能提升百分比: (tree_time - flat_time) / tree_time * 100.0
   - 平均执行时间
   - 平均性能提升

## 4. 测试结果

测试结果将输出以下信息：

1. 示例表达式计算结果
2. 扁平化指令序列
3. 每次性能测试的详细信息
4. 总结统计

## 5. 测试脚本

测试通过以下命令执行：
```bash
cd ~/expr_demo
make
./expr_demo

表达式计算演示
----------------

表达式: (((x0 + 2.50) * (x1 - 1.00)) / (x2 + x3))

树遍历结果: 5.000000
扁平化表达式 (指令数: 11):
  0: LOAD_VAR x0
  1: LOAD_CONST 2.50
  2: ADD
  3: LOAD_VAR x1
  4: LOAD_CONST 1.00
  5: SUB
  6: MUL
  7: LOAD_VAR x2
  8: LOAD_VAR x3
  9: ADD
  10: DIV

扁平数组结果: 5.000000

开始性能测试 (测试次数: 5, 最大深度: 5)
测试 #1:
  表达式: (((x4 + ((x2 - x2) * 7.40)) + x3) + ((0.10 / x4) - x4))
  树遍历时间: 0.122256 秒
  扁平数组时间: 0.170406 秒
  性能提升: -39.38%
测试 #2:
  表达式: ((4.00 * ((x3 - (x3 - 4.80)) - (8.50 / x0))) - 0.10)
  树遍历时间: 0.088525 秒
  扁平数组时间: 0.070751 秒
  性能提升: 20.08%
测试 #3:
  表达式: (4.70 - ((((2.60 + 2.40) / (2.30 - 3.60)) - ((x4 / 6.90) + (x1 * x0))) - (((6.60 + 2.60) + (0.30 + x1)) - (7.70 * (x2 + 2.70)))))
  树遍历时间: 0.138181 秒
  扁平数组时间: 0.128161 秒
  性能提升: 7.25%
测试 #4:
  表达式: ((8.20 - (((x1 + 6.30) - (4.60 * 3.30)) + 6.20)) + ((((x3 - x3) / (2.00 + x3)) * ((x0 / x0) - x0)) / (((2.30 / 0.60) * x4) - (3.20 + (1.40 * 3.10)))))
  树遍历时间: 0.228733 秒
  扁平数组时间: 0.186245 秒
  性能提升: 18.58%
测试 #5:
  表达式: ((4.00 - (((x0 - 1.30) / 0.50) * (7.50 * x3))) * 1.90)
  树遍历时间: 0.057988 秒
  扁平数组时间: 0.053311 秒
  性能提升: 8.07%

总结:
  平均树遍历时间: 0.127137 秒
  平均扁平数组时间: 0.121775 秒
  平均性能提升: 4.22%
```



